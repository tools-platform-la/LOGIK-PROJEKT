# FLAME-COLORTOOLKIT: Custom OCIO Configuration Guide

<a id="toc"></a>
## Table of Contents
- [Purpose of the Scripts](#purpose-of-the-scripts)
- [Workflow Overview](#workflow-overview)
- [How to Run the Scripts](#how-to-run-the-scripts)
  - [Step 1: Generate OCIO Config JSON](#step-1-generate-ocio-config-json)
  - [Step 2: Generate OCIO Conversion Tasks](#step-2-generate-ocio-conversion-tasks)
  - [Step 3: Generate Flame ColorToolKit CTFs](#step-3-generate-flame-colortoolkit-ctfs)
- [Inputs](#inputs)
- [Outputs](#outputs)
- [Key Concepts](#key-concepts)
- [Sharing Custom Configurations](#sharing-custom-configurations)
- [Troubleshooting](#troubleshooting)

This guide explains how to use a suite of Python scripts to create custom OpenColorIO (OCIO) Compatible Colour Transform files called the Flame ColorToolKit. This process involves extracting OCIO color space information, defining color conversion tasks, and generating Color Transform Format (CTF) files.

## Purpose of the Scripts

The scripts in `src/utils/common/create/` automate the process of preparing OCIO configurations for use within Autodesk Flame's ColorToolKit:

1.  **`create_ocio_config_json_file.py`**: This script analyzes a specified Autodesk Flame OCIO configuration (`config.ocio`), extracts all available color spaces, and generates a structured JSON file and a Markdown report. This JSON file serves as a validated source of color space names for subsequent steps.
2.  **`create_ocio_conversion_tasks.py`**: This script reads existing camera CTF (Color Transform Format) files, infers their corresponding OCIO input color spaces, and then generates intermediate JSON files. Each JSON file describes a specific color conversion task (e.g., from a camera's log space to an ACES working space), referencing the validated OCIO color spaces.
3.  **`create_ocio_flame_colortoolkit.py`**: This is the final script in the pipeline. It reads the JSON conversion task files generated by `create_ocio_conversion_tasks.py` and uses PyOpenColorIO to create the actual `.ctf` files that Flame's ColorToolKit can utilize. It also generates inverse transforms and companion JSON recipe files for each CTF.

[back to top](#toc)

## Workflow Overview

The process of generating Flame ColorToolKit configurations follows these sequential steps:

1.  **OCIO Configuration Extraction**: The `create_ocio_config_json_file.py` script is run to parse the main OCIO configuration and create a JSON representation of its color spaces.
2.  **Conversion Task Definition**: The `create_ocio_conversion_tasks.py` script then uses this OCIO JSON to identify and define specific color conversion tasks based on existing camera CTF files, outputting these as individual JSON task files.
3.  **Flame CTF Generation**: Finally, the `create_ocio_flame_colortoolkit.py` script processes these task files to generate the forward and inverse `.ctf` files for Flame, along with their associated recipe files.

[back to top](#toc)

## How to Run the Scripts

The scripts should be run in the following order to ensure proper dependency resolution.

**Important Note on Python Interpreter:**
The scripts rely on specific Python packages (e.g., `PyOpenColorIO`) that are typically installed with Autodesk Flame's Python environment. To ensure compatibility and proper execution, the path to the correct Python interpreter is dynamically read from the `current_adsk_python_version.pref` file. This prevents issues with different Python versions or missing dependencies.

First, retrieve the path to the Autodesk Python interpreter:
```bash
ADSK_PYTHON_PATH=$(cat /home/pman/workspace/GitHub/phil-man-git-hub/LOGIK-PROJEKT/install/current_adsk_python_version.pref)
```

Then, use this variable to execute each script:

### Step 1: Generate OCIO Config JSON

Execute `create_ocio_config_json_file.py` to extract OCIO color space information.

```bash
"$ADSK_PYTHON_PATH" src/utils/common/create/create_ocio_config_json_file.py
```

### Step 2: Generate OCIO Conversion Tasks

Execute `create_ocio_conversion_tasks.py` to define color conversion tasks based on existing CTFs and the generated OCIO config.

```bash
"$ADSK_PYTHON_PATH" src/utils/common/create/create_ocio_conversion_tasks.py
```

### Step 3: Generate Flame ColorToolKit CTFs

Execute `create_ocio_flame_colortoolkit.py` to create the final Flame-compatible CTF files.

```bash
"$ADSK_PYTHON_PATH" src/utils/common/create/create_ocio_flame_colortoolkit.py
```

[back to top](#toc)

## Inputs

The scripts rely on the following inputs:

*   **`create_ocio_config_json_file.py`**:
    *   **Hardcoded OCIO Config**: `/opt/Autodesk/colour_mgmt/configs/flame_configs/2026.0/aces2.0_config/config.ocio` - This is the primary OCIO configuration file that the script parses.

*   **`create_ocio_conversion_tasks.py`**:
    *   **Camera CTF Directory**: `/opt/Autodesk/colour_mgmt/configs/legacy_configs/syncolor_ctfs/camera` - This directory contains the source camera CTF files from which conversion tasks are inferred.
    *   **OCIO Config JSON**: The `ocio_v<major>_<minor>_config.json` file generated by `create_ocio_config_json_file.py` (located in `cfg/site-cfg/ocio/`). This file is used to validate inferred color space names.

*   **`create_ocio_flame_colortoolkit.py`**:
    *   **Conversion Task JSON Files**: The JSON files generated by `create_ocio_conversion_tasks.py` (located in `cfg/site-cfg/flame-cfg/flame-presets/colour_mgmt/transforms/flame-colortoolkit/json/`). These files describe the color conversions to be performed.
    *   **ACES to ACEScg CTF**: `/opt/Autodesk/colour_mgmt/configs/legacy_configs/syncolor_ctfs/primaries/ACES_to_ACEScg.ctf` (and its inverse) - Used for specific ACEScg conversions.

[back to top](#toc)

## Outputs

The scripts generate several files at different stages of the workflow:

*   **`create_ocio_config_json_file.py`**:
    *   **OCIO Color Space Markdown Report**:
        *   **Location**: `cfg/site-cfg/ocio/ocio_v<major>_<minor>_color_space_names.md`
        *   **Content**: A human-readable Markdown file detailing the OCIO configuration and a list of all available color spaces.
    *   **OCIO Config JSON File**:
        *   **Location**: `cfg/site-cfg/ocio/ocio_v<major>_<minor>_config.json`
        *   **Content**: A structured JSON representation of the OCIO configuration, including color space names, used for programmatic access and validation.

*   **`create_ocio_conversion_tasks.py`**:
    *   **Conversion Task JSON Files**:
        *   **Location**: `cfg/site-cfg/flame-cfg/flame-presets/colour_mgmt/transforms/flame-colortoolkit/json/<subdirectory>/<conversion_name>.json`
        *   **Content**: Individual JSON files, each describing a specific color conversion task, including input/target OCIO color spaces and references to source CTF files.

*   **`create_ocio_flame_colortoolkit.py`**:
    *   **Flame Color Transform Format (.ctf) Files**:
        *   **Location**: `cfg/site-cfg/flame-cfg/flame-presets/colour_mgmt/transforms/flame-colortoolkit/<subdirectory>/<conversion_name>.ctf`
        *   **Content**: The actual color transform files that Autodesk Flame's ColorToolKit uses to perform color conversions. Both forward and inverse transforms are generated.
    *   **CTF Recipe JSON Files**:
        *   **Location**: `cfg/site-cfg/flame-cfg/flame-presets/colour_mgmt/transforms/flame-colortoolkit/<subdirectory>/<conversion_name>.json` (companion to each `.ctf` file)
        *   **Content**: JSON files detailing the creation process of each `.ctf`, including source JSON, transform direction, and a list of source transforms.

[back to top](#toc)

## Key Concepts

*   **OpenColorIO (OCIO)**: An open-source color management system that provides a consistent color experience across different applications and workflows.
*   **Color Transform Format (CTF)**: A file format used by Autodesk Flame and other applications to store color transformations.
*   **Flame ColorToolKit**: A LOGIK-PROJEKT Colour Management feature that allows users to apply custom color transforms (CTFs) to their media.
*   **Color Space**: A defined range of colors that a device or file can represent. OCIO uses color spaces to ensure accurate color reproduction.
*   **Inverse Transform**: A color transform that reverses the effect of a forward transform, allowing for round-trip color accuracy.

[back to top](#toc)

## Troubleshooting

*   **`PyOpenColorIO` Errors**: Ensure that `PyOpenColorIO` is correctly installed and accessible in your Python environment. Compatibility issues can arise if the OCIO library version does not match expectations.
*   **File Not Found Errors**: Verify that the hardcoded paths for the source OCIO config (`/opt/Autodesk/colour_mgmt/...`) and camera CTF files are correct and that the files exist at those locations on your system.
*   **Invalid JSON Errors**: If `create_ocio_flame_colortoolkit.py` reports invalid JSON, check the output of `create_ocio_conversion_tasks.py` to ensure the generated task files are well-formed.
*   **"Unknown" Input Space**: If `create_ocio_conversion_tasks.py` logs warnings about "Unknown" input spaces, the `get_input_space_from_ctf_name` function may need to be updated to recognize new CTF naming conventions.
*   **Logging**: Check the log files generated in the `logs/` directory for detailed error messages and warnings.

[back to top](#toc)
